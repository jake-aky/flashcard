<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>PDF to Flashcards</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			padding: 20px;
		}

		.container {
			max-width: 900px;
			margin: 0 auto;
		}

		header {
			text-align: center;
			color: white;
			margin-bottom: 40px;
		}

		header h1 {
			font-size: 2.5em;
			margin-bottom: 10px;
		}

		header p {
			font-size: 1.1em;
			opacity: 0.9;
		}

		.card {
			background: white;
			border-radius: 12px;
			padding: 30px;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
			margin-bottom: 20px;
		}

		.upload-section {
			text-align: center;
			padding: 40px 20px;
		}

		.upload-area {
			border: 3px dashed #667eea;
			border-radius: 8px;
			padding: 60px 20px;
			cursor: pointer;
			transition: all 0.3s;
			background: #f8f9ff;
		}

		.upload-area:hover {
			border-color: #764ba2;
			background: #f0f2ff;
		}

		.upload-area.dragover {
			background: #e8ebff;
			border-color: #764ba2;
		}

		.upload-icon {
			font-size: 3em;
			margin-bottom: 20px;
		}

		#fileInput {
			display: none;
		}

		.btn {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			border: none;
			padding: 12px 30px;
			border-radius: 6px;
			font-size: 1em;
			cursor: pointer;
			transition: transform 0.2s, box-shadow 0.2s;
		}

		.btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
		}

		.btn:disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}

		.btn-secondary {
			background: #6c757d;
			margin-left: 10px;
		}

		.processing {
			text-align: center;
			padding: 40px;
		}

		.spinner {
			border: 4px solid #f3f3f3;
			border-top: 4px solid #667eea;
			border-radius: 50%;
			width: 50px;
			height: 50px;
			animation: spin 1s linear infinite;
			margin: 0 auto 20px;
		}

		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}

		.flashcard-review {
			perspective: 1000px;
		}

		.flashcard {
			position: relative;
			width: 100%;
			min-height: 300px;
			cursor: pointer;
			transform-style: preserve-3d;
			transition: transform 0.6s;
		}

		.flashcard.flipped {
			transform: rotateY(180deg);
		}

		.flashcard-face {
			position: absolute;
			width: 100%;
			min-height: 300px;
			backface-visibility: hidden;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 40px;
			border-radius: 8px;
			font-size: 1.3em;
			text-align: center;
		}

		.flashcard-front {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}

		.flashcard-back {
			background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
			color: white;
			transform: rotateY(180deg);
		}

		.controls {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-top: 20px;
			flex-wrap: wrap;
			gap: 10px;
		}

		.progress {
			flex: 1;
			text-align: center;
			font-size: 1.1em;
			color: #555;
		}

		.action-buttons {
			display: flex;
			gap: 10px;
		}

		.flashcard-list {
			max-height: 400px;
			overflow-y: auto;
			margin-top: 20px;
		}

		.flashcard-item {
			padding: 15px;
			border-bottom: 1px solid #eee;
			transition: background 0.2s;
		}

		.flashcard-item:hover {
			background: #f8f9ff;
		}

		.flashcard-item strong {
			color: #667eea;
			display: block;
			margin-bottom: 5px;
		}

		.hidden {
			display: none;
		}

		.hint {
			font-size: 0.9em;
			color: #666;
			margin-top: 10px;
		}

		.stats {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
			gap: 15px;
			margin-top: 20px;
		}

		.stat-card {
			background: #f8f9ff;
			padding: 20px;
			border-radius: 8px;
			text-align: center;
		}

		.stat-card .number {
			font-size: 2em;
			font-weight: bold;
			color: #667eea;
		}

		.stat-card .label {
			color: #666;
			margin-top: 5px;
		}
	</style>
</head>

<body>
	<div class="container">
		<header>
			<h1>üìö PDF to Flashcards</h1>
			<p>Upload your study notes and generate flashcards instantly</p>
		</header>

		<!-- Upload Section -->
		<div id="uploadSection" class="card">
			<div class="upload-section">
				<div class="upload-area" id="uploadArea">
					<div class="upload-icon">üìÑ</div>
					<h2>Drop your PDF here or click to browse</h2>
					<p class="hint">PDF files up to 10MB</p>
					<input type="file" id="fileInput" accept=".pdf">
				</div>
				<div style="margin-top: 20px;">
					<button class="btn" id="uploadBtn" disabled>Generate Flashcards</button>
				</div>
			</div>
		</div>

		<!-- Processing Section -->
		<div id="processingSection" class="card hidden">
			<div class="processing">
				<div class="spinner"></div>
				<h2>Generating flashcards...</h2>
				<p style="margin-top: 10px; color: #666;">Extracting text and creating study materials</p>
			</div>
		</div>

		<!-- Review Section -->
		<div id="reviewSection" class="card hidden">
			<div class="flashcard-review">
				<div class="flashcard" id="flashcard">
					<div class="flashcard-face flashcard-front">
						<div id="questionText">Click to start</div>
					</div>
					<div class="flashcard-face flashcard-back">
						<div id="answerText">Answer</div>
					</div>
				</div>
				<p class="hint" style="text-align: center; margin-top: 15px;">Click card to flip</p>
			</div>

			<div class="controls">
				<div class="progress">
					<span id="currentCard">0</span> / <span id="totalCards">0</span>
				</div>
				<div class="action-buttons">
					<button class="btn btn-secondary" id="prevBtn">‚Üê Previous</button>
					<button class="btn" id="nextBtn">Next ‚Üí</button>
					<button class="btn btn-secondary" id="shuffleBtn">üîÄ Shuffle</button>
					<button class="btn btn-secondary" id="newPdfBtn">üìÑ New PDF</button>
				</div>
			</div>

			<div class="stats">
				<div class="stat-card">
					<div class="number" id="totalCount">0</div>
					<div class="label">Total Cards</div>
				</div>
				<div class="stat-card">
					<div class="number" id="reviewedCount">0</div>
					<div class="label">Reviewed</div>
				</div>
				<div class="stat-card">
					<div class="number" id="remainingCount">0</div>
					<div class="label">Remaining</div>
				</div>
			</div>
		</div>

		<!-- Flashcard List -->
		<div id="listSection" class="card hidden">
			<h3 style="margin-bottom: 15px;">All Flashcards</h3>
			<div class="flashcard-list" id="flashcardList"></div>
		</div>
	</div>

	<script>
		// Configure PDF.js worker
		pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

		// State
		let flashcards = [];
		let currentIndex = 0;
		let reviewedCards = new Set();
		let selectedFile = null;

		// DOM Elements
		const uploadArea = document.getElementById('uploadArea');
		const fileInput = document.getElementById('fileInput');
		const uploadBtn = document.getElementById('uploadBtn');
		const uploadSection = document.getElementById('uploadSection');
		const processingSection = document.getElementById('processingSection');
		const reviewSection = document.getElementById('reviewSection');
		const listSection = document.getElementById('listSection');
		const flashcard = document.getElementById('flashcard');
		const questionText = document.getElementById('questionText');
		const answerText = document.getElementById('answerText');
		const currentCard = document.getElementById('currentCard');
		const totalCards = document.getElementById('totalCards');
		const prevBtn = document.getElementById('prevBtn');
		const nextBtn = document.getElementById('nextBtn');
		const shuffleBtn = document.getElementById('shuffleBtn');
		const newPdfBtn = document.getElementById('newPdfBtn');
		const flashcardList = document.getElementById('flashcardList');
		const totalCount = document.getElementById('totalCount');
		const reviewedCount = document.getElementById('reviewedCount');
		const remainingCount = document.getElementById('remainingCount');

		// Upload Area Events
		uploadArea.addEventListener('click', () => fileInput.click());

		uploadArea.addEventListener('dragover', (e) => {
			e.preventDefault();
			uploadArea.classList.add('dragover');
		});

		uploadArea.addEventListener('dragleave', () => {
			uploadArea.classList.remove('dragover');
		});

		uploadArea.addEventListener('drop', (e) => {
			e.preventDefault();
			uploadArea.classList.remove('dragover');
			const file = e.dataTransfer.files[0];
			if (file && file.type === 'application/pdf') {
				handleFileSelect(file);
			}
		});

		fileInput.addEventListener('change', (e) => {
			const file = e.target.files[0];
			if (file) {
				handleFileSelect(file);
			}
		});

		function handleFileSelect(file) {
			selectedFile = file;
			uploadBtn.disabled = false;
			uploadArea.querySelector('h2').textContent = `Selected: ${file.name}`;
		}

		uploadBtn.addEventListener('click', async () => {
			if (!selectedFile) return;
			await processPDF(selectedFile);
		});

		async function extractTextFromPDF(file) {
			const arrayBuffer = await file.arrayBuffer();
			const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
			let fullText = '';

			for (let i = 1; i <= pdf.numPages; i++) {
				const page = await pdf.getPage(i);
				const textContent = await page.getTextContent();
				const pageText = textContent.items.map(item => item.str).join(' ');
				fullText += pageText + '\n\n';
			}

			return fullText;
		}

		async function generateFlashcards(text) {
			try {
				const response = await fetch('https://api.anthropic.com/v1/messages', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						model: 'claude-sonnet-4-20250514',
						max_tokens: 1000,
						messages: [{
							role: 'user',
							content: `Given the following study notes, generate flashcards in JSON format. Create 10-15 flashcards with clear questions and concise answers. Focus on key concepts, definitions, and important facts.

Return ONLY a JSON array in this exact format, with no other text:
[{"question": "What is...", "answer": "..."}, {"question": "...", "answer": "..."}]

Study notes:
${text.substring(0, 8000)}`
						}]
					})
				});

				const data = await response.json();
				const content = data.content[0].text.trim();

				// Extract JSON from response
				const jsonMatch = content.match(/\[[\s\S]*\]/);
				if (jsonMatch) {
					return JSON.parse(jsonMatch[0]);
				}

				throw new Error('Could not parse flashcards from response');
			} catch (error) {
				console.error('Error generating flashcards:', error);
				// Fallback: create simple flashcards from text sections
				return createFallbackFlashcards(text);
			}
		}

		function createFallbackFlashcards(text) {
			const sections = text.split(/\n\n+/).filter(s => s.trim().length > 50);
			const cards = [];

			for (let i = 0; i < Math.min(10, sections.length); i++) {
				const section = sections[i].trim();
				const sentences = section.split(/[.!?]+/).filter(s => s.trim());

				if (sentences.length >= 2) {
					cards.push({
						question: `What do you know about: ${sentences[0].trim().substring(0, 100)}...?`,
						answer: section.substring(0, 200)
					});
				}
			}

			return cards.length > 0 ? cards : [
				{ question: 'Sample Question', answer: 'Unable to generate flashcards from PDF content' }
			];
		}

		async function processPDF(file) {
			uploadSection.classList.add('hidden');
			processingSection.classList.remove('hidden');

			try {
				const text = await extractTextFromPDF(file);
				flashcards = await generateFlashcards(text);

				currentIndex = 0;
				reviewedCards.clear();

				processingSection.classList.add('hidden');
				reviewSection.classList.remove('hidden');
				listSection.classList.remove('hidden');

				displayFlashcard();
				updateStats();
				displayFlashcardList();
			} catch (error) {
				console.error('Error processing PDF:', error);
				alert('Error processing PDF. Please try again.');
				resetToUpload();
			}
		}

		function displayFlashcard() {
			if (flashcards.length === 0) return;

			const card = flashcards[currentIndex];
			questionText.textContent = card.question;
			answerText.textContent = card.answer;
			flashcard.classList.remove('flipped');

			currentCard.textContent = currentIndex + 1;
			totalCards.textContent = flashcards.length;

			reviewedCards.add(currentIndex);
			updateStats();
		}

		function updateStats() {
			totalCount.textContent = flashcards.length;
			reviewedCount.textContent = reviewedCards.size;
			remainingCount.textContent = flashcards.length - reviewedCards.size;
		}

		function displayFlashcardList() {
			flashcardList.innerHTML = flashcards.map((card, index) => `
                <div class="flashcard-item">
                    <strong>Q${index + 1}: ${card.question}</strong>
                    <div>${card.answer}</div>
                </div>
            `).join('');
		}

		flashcard.addEventListener('click', () => {
			flashcard.classList.toggle('flipped');
		});

		prevBtn.addEventListener('click', () => {
			if (currentIndex > 0) {
				currentIndex--;
				displayFlashcard();
			}
		});

		nextBtn.addEventListener('click', () => {
			if (currentIndex < flashcards.length - 1) {
				currentIndex++;
				displayFlashcard();
			}
		});

		shuffleBtn.addEventListener('click', () => {
			flashcards = flashcards.sort(() => Math.random() - 0.5);
			currentIndex = 0;
			reviewedCards.clear();
			displayFlashcard();
			displayFlashcardList();
		});

		newPdfBtn.addEventListener('click', resetToUpload);

		function resetToUpload() {
			uploadSection.classList.remove('hidden');
			processingSection.classList.add('hidden');
			reviewSection.classList.add('hidden');
			listSection.classList.add('hidden');

			selectedFile = null;
			flashcards = [];
			currentIndex = 0;
			reviewedCards.clear();
			fileInput.value = '';
			uploadBtn.disabled = true;
			uploadArea.querySelector('h2').textContent = 'Drop your PDF here or click to browse';
		}
	</script>
</body>

</html>
